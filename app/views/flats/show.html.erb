<div class="container">
  <div>
    <% @flat.photos.each do |photo| %>
      <%= cl_image_tag photo.key, height: 300, width: 400, crop: :fill %>
    <% end %>
  </div>

  <div>
    <h2><%= @flat.name %></h2>
    <p>Address: <%= @flat.address %></p>
    <p>Description: <%= @flat.description  %></p>
    <p>Number of Guests: <%= @flat.guest_num  %></p>
    <p>Price per night: â‚¬<%= @flat.price_per_night  %></p>
    <%# <p>Rating: <%= @flat.rating %>
  </div>

  <%# if user is owner, hide book this property %>
  <% if policy(@flat).edit? %>
  <% else %>
    <%= link_to "Book the property", new_flat_booking_path(@flat), class: "btn btn-primary" %>
  <% end %>

  <%= link_to "Back to flats", flats_path, class: "btn btn-primary" %>

  <% if policy(@flat).destroy? %>
    <%= link_to "Delete",
      flat_path(@flat), class: "btn btn-danger",
      data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}
    %>
  <% else %>
  <% end %>

  <% if policy(@flat).edit? %>
    <%= link_to "Edit this property", edit_flat_path, class: "btn btn-primary" %>
  <% else %>
  <% end %>

  <%# Cannot leave a review for your own property %>
  <% if policy(@flat).edit? %>
  <% else %>
    <%= link_to "Add a new review", new_flat_review_path(@flat), class: "btn btn-primary" %>
  <% end %>

<h2>Location</h2>
<div style="width: 100%; height: 300px;"
  data-controller="map"
  <%# Must link controller to js file with stimulus %>
  data-map-markers-value="<%= @markers.to_json %>"
  data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"></div>
  <%# Line above keeps API key private %>

  <h2>Reviews</h2>
  <div>
    <% @flat.reviews.each do |review| %>
      <p>Content: <%= review.content %></p>
      <p>Location: <%= review.location %></p>
      <p>Cleanliness: <%= review.cleanliness %></p>
      <p>Value: <%= review.value %></p>
      <% overall = (review.value + review.location + review.cleanliness)/3.to_f %>
      <p>Overall: <%= (overall* 2.0).round / 2.0 %></p>

      <%# <%= link_to "Delete", # "delete" for delete action %>
      <%# review_path(review), # give review we want to delete %>
      <%# data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %>
      <%# # must say turbo method otherwise it will be show page of a review and not the delete method %>
      <%# %>
  <% end %>
  </div>


</div>
